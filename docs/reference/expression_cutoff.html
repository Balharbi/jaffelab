<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find expression cutoffs — expression_cutoff • jaffelab</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Find expression cutoffs — expression_cutoff" />
<meta property="og:description" content="This function finds expression cutoffs based on estimating the second
breakpoint using segmented applied to two curves. The
first curve is the number of features passing the cutoff assuming an initial
large drop, an intermediate section with moderate drop, and then a stable
tail. The second curve is the mean number of expressed samples (non-zero
expression) for all genes at each given cutoff. This curve increases rapidly
then has a section with a moderate increase, and finally a long tail. Using
segmented we find that second breakpoint. The suggested
expression cutoff returned is the average of the two suggested cutoffs." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jaffelab</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.28</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/jaffelab-quickstart.html">jaffelab quick start guide</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/LieberInstitute/jaffelab">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find expression cutoffs</h1>
    <small class="dont-index">Source: <a href='https://github.com/LieberInstitute/jaffelab/blob/master/R/expression_cutoff.R'><code>R/expression_cutoff.R</code></a></small>
    <div class="hidden name"><code>expression_cutoff.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function finds expression cutoffs based on estimating the second
breakpoint using <a href='https://rdrr.io/pkg/segmented/man/segmented.html'>segmented</a> applied to two curves. The
first curve is the number of features passing the cutoff assuming an initial
large drop, an intermediate section with moderate drop, and then a stable
tail. The second curve is the mean number of expressed samples (non-zero
expression) for all genes at each given cutoff. This curve increases rapidly
then has a section with a moderate increase, and finally a long tail. Using
segmented we find that second breakpoint. The suggested
expression cutoff returned is the average of the two suggested cutoffs.</p>
    </div>

    <pre class="usage"><span class='fu'>expression_cutoff</span>(<span class='no'>expr</span>, <span class='kw'>max_cut</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>seed</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>n.boot</span> <span class='kw'>=</span> <span class='fl'>2000</span>,
  <span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>2</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>expr</th>
      <td><p>A matrix with the expression values with features in the rows and
samples in the columns in RPKM format.</p></td>
    </tr>
    <tr>
      <th>max_cut</th>
      <td><p>Maximum expression cutoff to consider. Increasing this value
does then to increase the suggested cutoffs. If set to <code>NULL</code>, this
will be chosen automatically from 1 to 5.</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>Set this argument for increased reproducibility of the results.
This is passed to <a href='https://rdrr.io/pkg/segmented/man/seg.control.html'>seg.control</a>. We highly recommend
specifiying this value.</p></td>
    </tr>
    <tr>
      <th>n.boot</th>
      <td><p>This argument controls the stability of the suggested cutoffs.
It is passed to <a href='https://rdrr.io/pkg/segmented/man/seg.control.html'>seg.control</a>.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>The number of breakpoints to consider. If you increase this value
the estimated breakpoints are less stable.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A two element vector with the suggested cutoffs based on the
number of features expressed and the mean number of expressed samples
across all features. The function also makes plots that visualize
both curves and show the identified breakpoints as vertical grey lines.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>## Simulate expression data. Based on the limma::lmFit() man page</span>
<span class='no'>sd</span> <span class='kw'>&lt;-</span> <span class='fl'>0.3</span>*<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='fl'>4</span>/<span class='fu'><a href='https://rdrr.io/r/stats/Chisquare.html'>rchisq</a></span>(<span class='fl'>100</span>,<span class='kw'>df</span><span class='kw'>=</span><span class='fl'>4</span>))
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fl'>100</span>*<span class='fl'>6</span>,<span class='kw'>sd</span><span class='kw'>=</span><span class='no'>sd</span>),<span class='fl'>100</span>,<span class='fl'>6</span>)
<span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span>(<span class='no'>y</span>) <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>"Gene"</span>,<span class='fl'>1</span>:<span class='fl'>100</span>)
<span class='no'>y</span>[<span class='fl'>1</span>:<span class='fl'>2</span>,<span class='fl'>4</span>:<span class='fl'>6</span>] <span class='kw'>&lt;-</span> <span class='no'>y</span>[<span class='fl'>1</span>:<span class='fl'>2</span>,<span class='fl'>4</span>:<span class='fl'>6</span>] + <span class='fl'>2</span>

<span class='co'>## Make the expression data look like RPKM values</span>
<span class='no'>y2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>y</span>, <span class='fl'>2</span>, <span class='kw'>function</span>(<span class='no'>z</span>) {
    <span class='no'>res</span> <span class='kw'>&lt;-</span> <span class='no'>z</span> + <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span>(<span class='no'>z</span>))
    <span class='no'>res</span>[<span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_len</a></span>(<span class='fl'>100</span>), <span class='fl'>10</span>)] <span class='kw'>&lt;-</span> <span class='fl'>0</span>
    <span class='no'>res</span>
})
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>y2</span>)</div><div class='output co'>#&gt;        V1              V2               V3               V4        
#&gt;  Min.   :0.000   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000  
#&gt;  1st Qu.:0.812   1st Qu.:0.5794   1st Qu.:0.6757   1st Qu.:0.7014  
#&gt;  Median :1.061   Median :0.8119   Median :0.9338   Median :1.0135  
#&gt;  Mean   :1.002   Mean   :0.8070   Mean   :0.8705   Mean   :0.9828  
#&gt;  3rd Qu.:1.264   3rd Qu.:1.0926   3rd Qu.:1.1058   3rd Qu.:1.2464  
#&gt;  Max.   :2.472   Max.   :2.1606   Max.   :1.9088   Max.   :3.3155  
#&gt;        V5              V6       
#&gt;  Min.   :0.000   Min.   :0.000  
#&gt;  1st Qu.:1.107   1st Qu.:1.435  
#&gt;  Median :1.470   Median :1.699  
#&gt;  Mean   :1.364   Mean   :1.558  
#&gt;  3rd Qu.:1.710   3rd Qu.:1.894  
#&gt;  Max.   :3.563   Max.   :3.829  </div><div class='input'>
<span class='fu'>expression_cutoff</span>(<span class='no'>y2</span>)</div><div class='img'><img src='expression_cutoff-1.png' alt='' width='700' height='433' /></div><div class='img'><img src='expression_cutoff-2.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; <span class='message'>2019-09-12 19:48:56 the suggested expression cutoff is 0.85</span></div><div class='img'><img src='expression_cutoff-3.png' alt='' width='700' height='433' /></div><div class='output co'>#&gt; percent_features_cut  samples_nonzero_cut 
#&gt;                 0.93                 0.77 </div><div class='input'>
<span class='co'>## Or same the plots to a PDF file</span>

<span class='fu'><a href='https://rdrr.io/r/grDevices/pdf.html'>pdf</a></span>(<span class='st'>'test_expression_cutoff.pdf'</span>, <span class='kw'>width</span> <span class='kw'>=</span> <span class='fl'>12</span>)
<span class='fu'>expression_cutoff</span>(<span class='no'>y2</span>)</div><div class='output co'>#&gt; <span class='message'>2019-09-12 19:49:09 the suggested expression cutoff is 0.85</span></div><div class='output co'>#&gt; percent_features_cut  samples_nonzero_cut 
#&gt;                 0.93                 0.77 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span>()</div><div class='output co'>#&gt; pdf 
#&gt;   2 </div><div class='input'>
<span class='co'>## View the pdf with the following code</span>
<span class='kw pkg'>utils</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/utils/browseURL.html'>browseURL</a></span>(<span class='st'>'test_expression_cutoff.pdf'</span>)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Leonardo Collado-Torres</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Leonardo Collado-Torres, Andrew E. Jaffe, Emily E. Burke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


